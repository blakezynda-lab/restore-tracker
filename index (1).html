<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restore ‚Äî Project Command</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
body{margin:0;background:#111316}
#root{height:100vh}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

// ‚îÄ‚îÄ STORAGE (localStorage ‚Äî works on any host) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LS_JOBS  = 'restore_jobs_v1';
const LS_USERS = 'restore_users_v1';
function lsGet(key) { try { const v=localStorage.getItem(key); return v?JSON.parse(v):null; } catch{return null;} }
function lsSet(key,val) { try { localStorage.setItem(key,JSON.stringify(val)); return true; } catch(e){console.error(e);return false;} }

// ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const USER_COLORS=['#f59e0b','#3b82f6','#22c55e','#ef4444','#a855f7','#06b6d4','#f97316','#ec4899','#14b8a6','#8b5cf6'];
const STATUS_MAP={
  new:{label:'New / Lead',color:'#3b82f6'},assess:{label:'Assessment',color:'#a855f7'},
  drying:{label:'Drying',color:'#06b6d4'},remed:{label:'Remediation',color:'#f97316'},
  recon:{label:'Reconstruction',color:'#eab308'},pending:{label:'Pending',color:'#6b7280'},
  complete:{label:'Complete',color:'#22c55e'},cancelled:{label:'Cancelled',color:'#ef4444'},
};
const FU_MAP={
  waiting:{label:'Waiting Response',color:'#f59e0b',icon:'‚è±'},
  followup:{label:'Follow-Up Scheduled',color:'#3b82f6',icon:'üìÖ'},
  insurance:{label:'Waiting on Insurance',color:'#a855f7',icon:'üõ°'},
  equipment:{label:'Equipment Pulled',color:'#06b6d4',icon:'üîß'},
  upload:{label:'Ready to Upload',color:'#22c55e',icon:'‚úÖ'},
};
const TYPE_LABELS={water:'Water Mitigation',mold:'Mold Remediation',both:'Water + Mold',other:'Other'};
const TYPE_COLORS={water:'#06b6d4',mold:'#a855f7',both:'#f97316',other:'#6b7280'};
const CAT_LABELS={cat1:'Cat 1 ‚Äî Clean',cat2:'Cat 2 ‚Äî Grey',cat3:'Cat 3 ‚Äî Black','':''};

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const genId=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const todayStr=()=>new Date().toISOString().slice(0,10);
const nowStr=()=>new Date().toISOString();
const fmtDate=s=>{if(!s)return'';const d=new Date(s+'T12:00:00');return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});};
const fmtDT=s=>{if(!s)return'';const d=new Date(s);return d.toLocaleDateString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});};
function compressImage(file){return new Promise(resolve=>{const r=new FileReader();r.onload=e=>{const img=new Image();img.onload=()=>{const MAX=800,Q=0.65;let w=img.width,h=img.height;if(w>MAX||h>MAX){if(w>h){h=Math.round(h*MAX/w);w=MAX;}else{w=Math.round(w*MAX/h);h=MAX;}}const c=document.createElement('canvas');c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);resolve({data:c.toDataURL('image/jpeg',Q),name:file.name,date:nowStr()});};img.src=e.target.result;};r.readAsDataURL(file);});}

// ‚îÄ‚îÄ ICONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GridIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>;
const ClockIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
const ShieldIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
const CheckIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
const DropIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>;
const MoldIc=()=><svg className="nav-ic" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22c-4.97 0-9-4.03-9-9 0-4.17 6-14 9-14s9 9.83 9 14c0 4.97-4.03 9-9 9z"/></svg>;
const BellIc=()=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{width:15,height:15,display:'block'}}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>;
const PlusIc=()=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" style={{width:13,height:13}}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
const BackIc=()=><svg style={{width:13,height:13}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"/></svg>;
const XI=()=><svg style={{width:17,height:17}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
const EditIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
const TrashIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg>;
const LogoutIc=()=><svg style={{width:13,height:13}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
const SearchIc=()=><svg style={{width:13,height:13}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>;
const PhotoIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>;
const NoteIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>;
const PersonIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
const CalIc=()=><svg style={{width:12,height:12}} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
const DownloadIc=()=><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{width:13,height:13}}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;

// ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App() {
  const [screen,setScreen]=useState('auth');
  const [authTab,setAuthTab]=useState('login');
  const [currentUser,setCU]=useState(null);
  const [jobs,setJobs]=useState([]);
  const [view,setView]=useState('dashboard');
  const [navFilt,setNF]=useState('all');
  const [sfilt,setSF]=useState('all');
  const [searchQ,setSQ]=useState('');
  const [curJobId,setCJI]=useState(null);
  const [showJobModal,setSJM]=useState(false);
  const [editJob,setEJ]=useState(null);
  const [showBriefing,setSB]=useState(false);
  const [lightbox,setLB]=useState(null);
  const [jobForm,setJF]=useState({});
  const [loginF,setLF]=useState({username:'',pin:''});
  const [regF,setRF]=useState({username:'',displayName:'',pin:''});
  const [authErr,setAE]=useState('');
  const [authLd,setAL]=useState(false);
  const [toast,setTst]=useState(null);
  const [saving,setSaving]=useState(false);
  const [detailNotes,setDN]=useState('');
  const [tlInput,setTLI]=useState('');
  const [fuNote,setFUN]=useState('');
  const [fuDate,setFUD]=useState('');
  const [briefEdits,setBE]=useState({});
  const [showImport,setSI]=useState(false);
  const [importState,setIS]=useState('idle');
  const [importData,setID]=useState(null);
  const [importMsg,setIM]=useState('');
  const toastRef=useRef(null);
  const briefShown=useRef(false);
  const photoRef=useRef(null);
  const importRef=useRef(null);

  // Load jobs on mount / login
  useEffect(()=>{
    if(!currentUser)return;
    const saved=lsGet(LS_JOBS)||[];
    setJobs(saved);
    // Auto-briefing once per day
    const key='restore_briefed_'+todayStr();
    if(!localStorage.getItem(key)){
      setTimeout(()=>{
        const j=lsGet(LS_JOBS)||[];
        if(getAlerts(j).length>0&&!briefShown.current){
          briefShown.current=true;
          localStorage.setItem(key,'1');
          setSB(true);
        }
      },1200);
    }
  },[currentUser]);

  function persist(newJobs){
    setSaving(true);
    lsSet(LS_JOBS,newJobs);
    setJobs(newJobs);
    setTimeout(()=>setSaving(false),400);
  }

  function showToast(msg,type='success'){
    clearTimeout(toastRef.current);
    setTst({msg,type});
    toastRef.current=setTimeout(()=>setTst(null),2800);
  }

  // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
  function doLogin(){
    setAE('');setAL(true);
    if(!loginF.username||!loginF.pin){setAE('Enter username and PIN.');setAL(false);return;}
    const users=lsGet(LS_USERS)||{};
    const u=users[loginF.username.toLowerCase()];
    if(!u){setAE('Username not found.');setAL(false);return;}
    if(u.pin!==loginF.pin){setAE('Incorrect PIN.');setAL(false);return;}
    setCU({username:loginF.username.toLowerCase(),displayName:u.displayName,color:u.color});
    setScreen('app');setAL(false);
  }
  function doRegister(){
    setAE('');setAL(true);
    const{username,displayName,pin}=regF;
    if(!username||!displayName||!pin){setAE('All fields are required.');setAL(false);return;}
    if(!/^\d{4,8}$/.test(pin)){setAE('PIN must be 4‚Äì8 digits.');setAL(false);return;}
    if(username.length<3){setAE('Username must be at least 3 characters.');setAL(false);return;}
    const users=lsGet(LS_USERS)||{};
    if(users[username.toLowerCase()]){setAE('That username is already taken.');setAL(false);return;}
    const color=USER_COLORS[Object.keys(users).length%USER_COLORS.length];
    users[username.toLowerCase()]={displayName,pin,color,createdAt:nowStr()};
    lsSet(LS_USERS,users);
    setCU({username:username.toLowerCase(),displayName,color});
    setScreen('app');setAL(false);
  }
  function doLogout(){
    if(!confirm('Sign out?'))return;
    setCU(null);setJobs([]);setView('dashboard');setCJI(null);briefShown.current=false;setScreen('auth');
  }

  // ‚îÄ‚îÄ JOB CRUD ‚îÄ‚îÄ
  function openNew(){
    const year=new Date().getFullYear();
    const num=String(jobs.length+1).padStart(4,'0');
    setEJ(null);
    setJF({jobnum:`${year}-${num}`,startdate:todayStr(),status:'new',priority:'normal',type:'water',
           enddate:'',category:'',address:'',client:'',phone:'',email:'',altcontact:'',
           insco:'',claim:'',adjuster:'',adjphone:'',policy:'',deductible:'',description:'',notes:''});
    setSJM(true);
  }
  function openEdit(job){setEJ(job);setJF({...job});setSJM(true);}
  function saveJob(){
    if(!jobForm.address&&!jobForm.client){showToast('Enter address or client','error');return;}
    setSaving(true);
    let updated;
    if(editJob){
      updated=jobs.map(j=>j.id===editJob.id?{...j,...jobForm,updatedAt:nowStr(),updatedBy:currentUser.displayName}:j);
      showToast('Job updated');
    }else{
      const nj={id:genId(),...jobForm,photos:[],
        timeline:[{date:nowStr(),text:'Job created.',by:currentUser.displayName}],
        createdAt:nowStr(),createdBy:currentUser.displayName,updatedAt:nowStr(),updatedBy:currentUser.displayName};
      updated=[...jobs,nj];
      showToast('Job created');
    }
    persist(updated);setSJM(false);
  }
  function deleteJob(id){
    if(!confirm('Delete this job? Cannot be undone.'))return;
    setView('dashboard');setCJI(null);
    persist(jobs.filter(j=>j.id!==id));
    showToast('Job deleted');
  }
  function openDetail(id){
    const job=jobs.find(j=>j.id===id);if(!job)return;
    setCJI(id);setDN(job.notes||'');setFUD(job.fuDate||'');setFUN(job.fuNote||'');setView('detail');
  }
  const curJob=jobs.find(j=>j.id===curJobId);

  // ‚îÄ‚îÄ NOTES / TIMELINE / PHOTOS ‚îÄ‚îÄ
  function saveNotes(){
    if(!curJobId)return;
    persist(jobs.map(j=>j.id===curJobId?{...j,notes:detailNotes,updatedAt:nowStr(),updatedBy:currentUser.displayName}:j));
    showToast('Notes saved');
  }
  function addTL(){
    if(!tlInput.trim()||!curJobId)return;
    const entry={date:nowStr(),text:tlInput.trim(),by:currentUser.displayName};
    persist(jobs.map(j=>j.id===curJobId?{...j,timeline:[...(j.timeline||[]),entry],updatedAt:nowStr()}:j));
    setTLI('');showToast('Entry logged');
  }
  function delTL(idx){
    persist(jobs.map(j=>{if(j.id!==curJobId)return j;const tl=[...(j.timeline||[])];tl.splice(idx,1);return{...j,timeline:tl};}));
  }
  async function uploadPhotos(e){
    const files=Array.from(e.target.files);if(!files.length||!curJobId)return;
    showToast('Processing‚Ä¶');
    const comp=await Promise.all(files.map(compressImage));
    persist(jobs.map(j=>j.id===curJobId?{...j,photos:[...(j.photos||[]),...comp],updatedAt:nowStr(),updatedBy:currentUser.displayName}:j));
    showToast(`${files.length} photo(s) added`);e.target.value='';
  }
  function deletePhoto(idx){
    persist(jobs.map(j=>{if(j.id!==curJobId)return j;const p=[...(j.photos||[])];p.splice(idx,1);return{...j,photos:p};}));
  }

  // ‚îÄ‚îÄ FOLLOW-UP ‚îÄ‚îÄ
  function setFU(val){
    if(!curJobId)return;
    const info=FU_MAP[val];
    const entry={date:nowStr(),text:info?`Follow-up: ${info.label}`:'Follow-up cleared.',by:currentUser.displayName};
    persist(jobs.map(j=>j.id===curJobId?{...j,fuStatus:val,timeline:[...(j.timeline||[]),entry],updatedAt:nowStr()}:j));
    showToast(info?info.label:'Cleared');
  }
  function saveFUDate(date){
    if(!curJobId)return;setFUD(date);
    const entry={date:nowStr(),text:date?`Follow-up date: ${fmtDate(date)}`:'Follow-up date cleared.',by:currentUser.displayName};
    persist(jobs.map(j=>j.id===curJobId?{...j,fuDate:date,timeline:[...(j.timeline||[]),entry],updatedAt:nowStr()}:j));
  }
  function saveFUNote(){
    if(!curJobId||!fuNote.trim())return;
    persist(jobs.map(j=>j.id===curJobId?{...j,fuNote:fuNote.trim(),updatedAt:nowStr()}:j));
    showToast('Note saved');
  }

  // ‚îÄ‚îÄ ALERTS / BRIEFING ‚îÄ‚îÄ
  function getAlerts(jbs){
    const today=todayStr();
    return jbs.filter(j=>{
      if(['complete','cancelled'].includes(j.status))return false;
      if(j.fuDate&&j.fuDate<=today)return true;
      if(j.fuStatus)return true;
      if(['assess','drying','remed','recon'].includes(j.status)&&(j.lastChecked||'')<today)return true;
      return false;
    });
  }
  function saveBriefing(){
    const today=todayStr();
    const updated=jobs.map(j=>{
      const ed=briefEdits[j.id];
      const isAlert=getAlerts([j]).length>0;
      if(!ed&&!isAlert)return j;
      const ch={lastChecked:today,updatedAt:nowStr()};
      if(ed?.fuStatus!==undefined)ch.fuStatus=ed.fuStatus;
      if(ed?.fuDate!==undefined)ch.fuDate=ed.fuDate;
      const fi=FU_MAP[ch.fuStatus!==undefined?ch.fuStatus:j.fuStatus];
      const entry={date:nowStr(),text:fi?`Daily check: "${fi.label}"`:'Daily check logged.',by:currentUser.displayName};
      ch.timeline=[...(j.timeline||[]),entry];
      return{...j,...ch};
    });
    persist(updated);setBE({});setSB(false);showToast('Briefing saved');
  }

  // ‚îÄ‚îÄ EXPORT / IMPORT ‚îÄ‚îÄ
  function exportJobs(){
    if(!jobs.length){showToast('No jobs to export','error');return;}
    const payload={exportedAt:nowStr(),exportedFrom:'Restore Project Command',version:1,jobs};
    const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;
    a.download=`restore-export-${todayStr()}.json`;
    document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
    showToast(`Exported ${jobs.length} job(s)`);
  }
  function handleImportFile(e){
    const file=e.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=ev=>{
      try{
        const raw=JSON.parse(ev.target.result);
        const jobArray=Array.isArray(raw)?raw:(raw.jobs||[]);
        if(!jobArray.length){setIM('No jobs found in that file.');setIS('error');return;}
        setID(jobArray);setIM('');setIS('confirm');
      }catch{setIM('Could not read the file. Make sure it is the exported JSON from your tracker.');setIS('error');}
    };
    reader.readAsText(file);e.target.value='';
  }
  function confirmImport(){
    if(!importData)return;setIS('importing');
    try{
      const existing=lsGet(LS_JOBS)||[];
      const existingIds=new Set(existing.map(j=>j.id));
      const incoming=importData
        .filter(j=>!existingIds.has(j.id))
        .map(j=>({
          ...j,
          id:j.id||genId(),photos:j.photos||[],
          timeline:[...(j.timeline||[]),{date:nowStr(),text:`Imported by ${currentUser.displayName}.`,by:currentUser.displayName}],
          createdAt:j.createdAt||nowStr(),updatedAt:j.updatedAt||nowStr(),
          createdBy:j.createdBy||currentUser.displayName,updatedBy:currentUser.displayName,
        }));
      const merged=[...existing,...incoming];
      persist(merged);
      setIS('done');
      setIM(`‚úì ${incoming.length} job(s) imported. ${importData.length-incoming.length>0?`(${importData.length-incoming.length} skipped ‚Äî already exist)`:''}`);
      showToast(`${incoming.length} job(s) imported!`);
      setTimeout(()=>{setSI(false);setIS('idle');setID(null);setIM('');},2500);
    }catch(err){setIM('Import failed: '+err.message);setIS('error');}
  }
  function cancelImport(){setSI(false);setIS('idle');setID(null);setIM('');}

  // ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ
  const today=todayStr();
  const filtered=jobs.filter(j=>{
    if(navFilt==='active'&&!['assess','drying','remed','recon'].includes(j.status))return false;
    if(navFilt==='pending'&&j.status!=='pending')return false;
    if(navFilt==='complete'&&j.status!=='complete')return false;
    if(navFilt==='water'&&j.type!=='water'&&j.type!=='both')return false;
    if(navFilt==='mold'&&j.type!=='mold'&&j.type!=='both')return false;
    if(sfilt!=='all'&&j.status!==sfilt)return false;
    if(searchQ){const h=[j.address,j.client,j.jobnum,j.insco,j.claim,j.description,j.notes].join(' ').toLowerCase();if(!h.includes(searchQ.toLowerCase()))return false;}
    return true;
  });
  const alerts=getAlerts(jobs);
  const stats={
    total:jobs.length,
    active:jobs.filter(j=>['assess','drying','remed','recon'].includes(j.status)).length,
    complete:jobs.filter(j=>j.status==='complete').length,
    hipri:jobs.filter(j=>j.priority==='high').length,
  };
  const navItems=[
    {id:'all',label:'All Jobs',Icon:GridIc,badge:stats.total},
    {id:'active',label:'Active',Icon:ClockIc,badge:stats.active},
    {id:'pending',label:'Pending',Icon:ShieldIc,badge:jobs.filter(j=>j.status==='pending').length},
    {id:'complete',label:'Completed',Icon:CheckIc,badge:stats.complete},
    {id:'water',label:'Water Mitigation',Icon:DropIc,badge:jobs.filter(j=>j.type==='water'||j.type==='both').length},
    {id:'mold',label:'Mold Remediation',Icon:MoldIc,badge:jobs.filter(j=>j.type==='mold'||j.type==='both').length},
  ];
  const statusChips=[
    {id:'all',label:'All'},{id:'new',label:'New',color:'#3b82f6'},{id:'assess',label:'Assessment',color:'#a855f7'},
    {id:'drying',label:'Drying',color:'#06b6d4'},{id:'remed',label:'Remediation',color:'#f97316'},
    {id:'recon',label:'Reconstruction',color:'#eab308'},{id:'pending',label:'Pending',color:'#6b7280'},
    {id:'complete',label:'Complete',color:'#22c55e'},{id:'cancelled',label:'Cancelled',color:'#ef4444'},
  ];

  function SBadge({status}){const s=STATUS_MAP[status]||STATUS_MAP.new;return <span className="sbadge" style={{color:s.color,borderColor:s.color+'55'}}><span className="sdot"/>{s.label}</span>;}
  function IFRow({label,value,mono}){return <div><div className="iflbl">{label}</div><div className={`ifval${mono?' mono':''}${!value?' empty':''}`}>{value||'‚Äî'}</div></div>;}

  // ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ
  if(screen==='auth')return(
    <div className="auth-wrap">
      <div className="auth-inner">
        <div className="auth-logo">Restore</div>
        <div className="auth-sub">Project Command</div>
        <div className="auth-card">
          <div className="auth-tabs">
            <div className={`atab${authTab==='login'?' active':''}`} onClick={()=>{setAuthTab('login');setAE('');}}>Sign In</div>
            <div className={`atab${authTab==='register'?' active':''}`} onClick={()=>{setAuthTab('register');setAE('');}}>Create Account</div>
          </div>
          {authErr&&<div className="auth-err">{authErr}</div>}
          {authTab==='login'?(
            <>
              <div className="af"><label className="al">Username</label><input className="ai" value={loginF.username} onChange={e=>setLF({...loginF,username:e.target.value})} placeholder="your-username" autoComplete="username"/></div>
              <div className="af"><label className="al">PIN</label><input className="ai" type="password" value={loginF.pin} onChange={e=>setLF({...loginF,pin:e.target.value})} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onKeyDown={e=>e.key==='Enter'&&doLogin()}/></div>
              <button className="auth-btn" disabled={authLd} onClick={doLogin}>{authLd?'Signing in‚Ä¶':'Sign In'}</button>
            </>
          ):(
            <>
              <div className="af"><label className="al">Full Name</label><input className="ai" value={regF.displayName} onChange={e=>setRF({...regF,displayName:e.target.value})} placeholder="Your name"/></div>
              <div className="af"><label className="al">Username</label><input className="ai" value={regF.username} onChange={e=>setRF({...regF,username:e.target.value})} placeholder="choose-a-username" autoComplete="username"/></div>
              <div className="af"><label className="al">PIN (4‚Äì8 digits)</label><input className="ai" type="password" value={regF.pin} onChange={e=>setRF({...regF,pin:e.target.value})} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onKeyDown={e=>e.key==='Enter'&&doRegister()}/></div>
              <button className="auth-btn" disabled={authLd} onClick={doRegister}>{authLd?'Creating‚Ä¶':'Create Account'}</button>
            </>
          )}
          <div className="auth-note"><strong>Note:</strong> Data saves to this browser/device. Use <strong>Export</strong> to back up or share jobs with teammates.</div>
        </div>
      </div>
    </div>
  );

  // ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ
  const initials=currentUser.displayName.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();

  return(
    <div className="app">
      {/* SIDEBAR */}
      <nav className="sidebar">
        <div className="sb-head">
          <div className="logo">Restore<span className="logo-sub">Project Command</span></div>
          <div className="user-chip">
            <div className="u-avatar" style={{background:`${currentUser.color}22`,border:`1px solid ${currentUser.color}55`,color:currentUser.color}}>{initials}</div>
            <span className="u-name">{currentUser.displayName}</span>
            <button className="logout-btn" onClick={doLogout} title="Sign out"><LogoutIc/></button>
          </div>
        </div>
        <div className="nav-sec">
          <div className="nav-lbl">Views</div>
          {navItems.map(({id,label,Icon,badge})=>(
            <div key={id} className={`nav-item${navFilt===id?' active':''}`} onClick={()=>{setNF(id);setView('dashboard');setCJI(null);}}>
              <Icon/>{label}<span className="nav-bdg">{badge}</span>
            </div>
          ))}
        </div>
        {alerts.length>0&&(
          <div className="alert-strip" onClick={()=>setSB(true)}>
            <div className="alert-lbl"><BellIc/> Jobs Need Attention</div>
            <div className="alert-num">{alerts.length}</div>
            <div className="alert-sub">{alerts.filter(j=>j.fuDate&&j.fuDate<today).length>0?`${alerts.filter(j=>j.fuDate&&j.fuDate<today).length} overdue ¬∑ tap to review`:'tap to review'}</div>
          </div>
        )}
        <div className="sb-stats">
          <div className="stat-box"><div className="stat-v">{stats.total}</div><div className="stat-l">Total Jobs</div></div>
          <div className="stat-box"><div className="stat-v" style={{color:'#f59e0b'}}>{stats.active}</div><div className="stat-l">In Progress</div></div>
          <div className="stat-box"><div className="stat-v" style={{color:'#22c55e'}}>{stats.complete}</div><div className="stat-l">Completed</div></div>
          <div className="stat-box"><div className="stat-v" style={{color:'#ef4444'}}>{stats.hipri}</div><div className="stat-l">High Priority</div></div>
        </div>
      </nav>

      {/* MAIN */}
      <div className="main">
        <div className="topbar">
          <div className="tb-title">{navItems.find(n=>n.id===navFilt)?.label||'Jobs'}</div>
          <div className="search-box"><SearchIc/><input value={searchQ} onChange={e=>setSQ(e.target.value)} placeholder="Search jobs, addresses, clients‚Ä¶"/></div>
          <button className={`bell-btn${alerts.length>0?' ringing':''}`} onClick={()=>setSB(true)} title="Daily briefing">
            <BellIc/>{alerts.length>0&&<span className="bell-count">{alerts.length}</span>}
          </button>
          <button className="btn btn-ghost" onClick={exportJobs} title="Export all jobs to a file" style={{whiteSpace:'nowrap'}}><DownloadIc/>Export</button>
          <button className="btn btn-ghost" onClick={()=>{setSI(true);setIS('idle');setID(null);setIM('');}} title="Import jobs from file" style={{whiteSpace:'nowrap'}}><DownloadIc/>Import</button>
          <button className="btn btn-amber" onClick={openNew}><PlusIc/>New Job</button>
        </div>

        <div className="filterbar">
          {statusChips.map(({id,label,color})=>(
            <div key={id} className={`fc${sfilt===id?' active':''}`} onClick={()=>setSF(id)}>
              {color&&<span className="fc-dot" style={{background:color}}/>}{label}
            </div>
          ))}
        </div>

        <div className="content">
          {/* DASHBOARD */}
          {view==='dashboard'&&(
            <div className="cards-grid">
              {filtered.length===0?(
                <div className="empty">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                  <h3>No Jobs Found</h3>
                  <p>No jobs match current filters. Click <strong>New Job</strong> to get started.</p>
                </div>
              ):filtered.map(j=>{
                const s=STATUS_MAP[j.status]||STATUS_MAP.new;
                const fu=FU_MAP[j.fuStatus];
                const isOv=j.fuDate&&j.fuDate<today;
                const isTd=j.fuDate===today;
                return(
                  <div key={j.id} className="job-card" onClick={()=>openDetail(j.id)}>
                    <div style={{position:'absolute',left:0,top:0,bottom:0,width:4,background:s.color,borderRadius:'10px 0 0 10px'}}/>
                    {isOv&&<span className="overdue-flag">‚ö† OVERDUE</span>}
                    {!isOv&&isTd&&<span className="today-flag">üìã DUE TODAY</span>}
                    <div className="card-top"><span className="jnum">{j.jobnum||'‚Äî'}</span><SBadge status={j.status}/></div>
                    <div className="jaddr">{j.address||'No Address'}</div>
                    <div className="jclient">{j.client||'No client'}</div>
                    <div className="card-meta">
                      <span className="ttag" style={{color:TYPE_COLORS[j.type]||'#6b7280'}}>{TYPE_LABELS[j.type]||'‚Äî'}</span>
                      {j.category&&<span className="ttag">{CAT_LABELS[j.category]}</span>}
                      {fu&&<span className="fu-pill" style={{color:fu.color,borderColor:fu.color+'44'}}>{fu.icon} {fu.label}</span>}
                      {j.priority==='high'&&<span style={{fontSize:10,color:'#ef4444',fontFamily:"'IBM Plex Mono',monospace"}}>‚ö† HIGH</span>}
                      {j.startdate&&<span className="meta-ic"><CalIc/>{fmtDate(j.startdate)}</span>}
                      {(j.photos||[]).length>0&&<span className="meta-ic"><PhotoIc/>{j.photos.length}</span>}
                      {(j.timeline||[]).length>0&&<span className="meta-ic"><span style={{fontSize:8}}>üïê</span>{j.timeline.length}</span>}
                    </div>
                    {j.updatedBy&&<div style={{marginTop:7,fontSize:9,color:'#5f6878',fontFamily:"'IBM Plex Mono',monospace"}}>{j.updatedBy} ¬∑ {fmtDT(j.updatedAt)}</div>}
                  </div>
                );
              })}
            </div>
          )}

          {/* DETAIL */}
          {view==='detail'&&curJob&&(()=>{
            const fu=FU_MAP[curJob.fuStatus];
            const fuDateVal=fuDate||curJob.fuDate||'';
            const isOv=fuDateVal&&fuDateVal<today;
            const isTd=fuDateVal===today;
            return(
              <>
                <button className="back-btn" onClick={()=>{setView('dashboard');setCJI(null);}}><BackIc/>All Jobs</button>
                <div className="detail-hdr">
                  <div className="d-info">
                    <div className="d-jnum">{curJob.jobnum||'No Job #'}</div>
                    <div className="d-addr">{curJob.address||'No Address'}</div>
                    <div className="d-meta">
                      <SBadge status={curJob.status}/>
                      <span className="ttag" style={{color:TYPE_COLORS[curJob.type]||'#6b7280'}}>{TYPE_LABELS[curJob.type]||'‚Äî'}</span>
                      {curJob.category&&<span className="ttag">{CAT_LABELS[curJob.category]}</span>}
                      {fu&&<span className="fu-pill" style={{color:fu.color,borderColor:fu.color+'44'}}>{fu.icon} {fu.label}</span>}
                      {curJob.priority==='high'&&<span style={{fontSize:11,color:'#ef4444',fontFamily:"'IBM Plex Mono',monospace"}}>‚ö† High Priority</span>}
                      {curJob.startdate&&<span style={{fontSize:11,color:'#9ba3b0',fontFamily:"'IBM Plex Mono',monospace"}}>Started: {fmtDate(curJob.startdate)}</span>}
                    </div>
                  </div>
                  <div className="d-actions">
                    <button className="btn btn-ghost btn-sm" onClick={()=>openEdit(curJob)}><EditIc/>Edit</button>
                    <button className="btn btn-red btn-sm" onClick={()=>deleteJob(curJob.id)}><TrashIc/>Delete</button>
                  </div>
                </div>
                {/* Follow-up panel */}
                <div className="fu-panel">
                  <div className="fu-title"><BellIc/>Follow-Up Status</div>
                  <div className="fu-opts">
                    {Object.entries(FU_MAP).map(([key,info])=>(
                      <button key={key} className="fu-opt"
                        style={curJob.fuStatus===key?{borderColor:info.color,background:info.color+'18',color:info.color}:{}}
                        onClick={()=>setFU(key)}>{info.icon} {info.label}</button>
                    ))}
                    <button className="fu-opt" onClick={()=>setFU('')} style={{opacity:.6}}>‚úï Clear Status</button>
                  </div>
                  <div className="fu-row">
                    <label className="fu-lbl">Follow-Up Date</label>
                    <input type="date" className="fu-date-in" value={fuDateVal} onChange={e=>saveFUDate(e.target.value)}/>
                    {fuDateVal&&<span className="fu-date-disp" style={{color:isOv?'#ef4444':isTd?'#f59e0b':'#5f6878'}}>{isOv?'‚ö† Overdue':isTd?'üìã Due Today':''}</span>}
                  </div>
                  <div className="fu-note-row">
                    <input type="text" className="fu-note-in" value={fuNote} onChange={e=>setFUN(e.target.value)} onBlur={saveFUNote} placeholder="Follow-up note (optional)‚Ä¶"/>
                    <button className="btn btn-ghost btn-sm" onClick={saveFUNote}>Save</button>
                  </div>
                </div>
                {/* Info grid */}
                <div className="detail-grid">
                  <div className="dcard">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><PersonIc/>Client / Contact</span></div>
                    <div className="info-grid">
                      <IFRow label="Client Name" value={curJob.client}/><IFRow label="Phone" value={curJob.phone} mono/>
                      <IFRow label="Email" value={curJob.email} mono/><IFRow label="Alt. Contact" value={curJob.altcontact}/>
                    </div>
                  </div>
                  <div className="dcard">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><ShieldIc/>Insurance</span></div>
                    <div className="info-grid">
                      <IFRow label="Insurance Co." value={curJob.insco}/><IFRow label="Claim #" value={curJob.claim} mono/>
                      <IFRow label="Adjuster" value={curJob.adjuster}/><IFRow label="Adj. Phone" value={curJob.adjphone} mono/>
                      <IFRow label="Policy #" value={curJob.policy} mono/><IFRow label="Deductible" value={curJob.deductible?'$'+curJob.deductible:''}/>
                    </div>
                  </div>
                  <div className="dcard">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><CalIc/>Job Details</span></div>
                    <div className="info-grid">
                      <IFRow label="Job #" value={curJob.jobnum} mono/><IFRow label="Type" value={TYPE_LABELS[curJob.type]}/>
                      <IFRow label="Category" value={CAT_LABELS[curJob.category]}/><IFRow label="Priority" value={curJob.priority?curJob.priority[0].toUpperCase()+curJob.priority.slice(1):''}/>
                      <IFRow label="Start" value={fmtDate(curJob.startdate)}/><IFRow label="Target" value={fmtDate(curJob.enddate)}/>
                    </div>
                  </div>
                  <div className="dcard">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><NoteIc/>Loss Description</span></div>
                    <div className="notes-disp" style={!curJob.description?{color:'#5f6878',fontStyle:'italic'}:{}}>{curJob.description||'No description provided.'}</div>
                  </div>
                  <div className="dcard full">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><NoteIc/>Field Notes</span><button className="btn btn-ghost btn-sm" onClick={saveNotes}>Save Notes</button></div>
                    <textarea className="notes-area" value={detailNotes} onChange={e=>setDN(e.target.value)} placeholder="Field notes, observations, instructions‚Ä¶"/>
                  </div>
                  <div className="dcard">
                    <div className="dcard-title"><span style={{display:'flex',alignItems:'center',gap:6}}><ClockIc/>Timeline / Log</span></div>
                    <div className="tl">
                      {!(curJob.timeline||[]).length&&<div style={{color:'#5f6878',fontSize:11,padding:'6px 0'}}>No entries yet.</div>}
                      {[...(curJob.timeline||[])].reverse().map((e,ri)=>{
                        const i=(curJob.timeline||[]).length-1-ri;
                        return(
                          <div key={ri} className="tl-item">
                            <div className="tl-date">{fmtDT(e.date)}{e.by&&<span className="tl-by">{e.by}</span>}</div>
                            <div className="tl-text">{e.text}</div>
                            <button className="tl-del" onClick={()=>delTL(i)}><XI/></button>
                          </div>
                        );
                      })}
                    </div>
                    <div className="tl-add">
                      <input className="tl-input" value={tlInput} onChange={e=>setTLI(e.target.value)} placeholder="Add a log entry‚Ä¶" onKeyDown={e=>e.key==='Enter'&&addTL()}/>
                      <button className="btn btn-ghost btn-sm" onClick={addTL}>+ Log</button>
                    </div>
                  </div>
                  <div className="dcard">
                    <div className="dcard-title">
                      <span style={{display:'flex',alignItems:'center',gap:6}}><PhotoIc/>Photos</span>
                      <span style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:9,color:'#5f6878'}}>{(curJob.photos||[]).length} photo(s)</span>
                    </div>
                    <div className="ph-grid">
                      <button className="ph-add" onClick={()=>photoRef.current.click()}><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" style={{width:16,height:16}}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Add</button>
                      {(curJob.photos||[]).map((p,i)=>(
                        <div key={i} className="ph-item">
                          <img src={p.data} alt="" onClick={()=>setLB(p.data)} style={{cursor:'zoom-in'}}/>
                          <button className="ph-del" onClick={()=>deletePhoto(i)}><XI/></button>
                        </div>
                      ))}
                    </div>
                    <input ref={photoRef} type="file" accept="image/*" multiple style={{display:'none'}} onChange={uploadPhotos}/>
                  </div>
                </div>
              </>
            );
          })()}
        </div>
      </div>

      {/* JOB MODAL */}
      {showJobModal&&(
        <div className="overlay" onClick={e=>e.target===e.currentTarget&&setSJM(false)}>
          <div className="modal">
            <div className="mhdr"><span className="mtitle">{editJob?'Edit Job':'New Job'}</span><button className="mclose" onClick={()=>setSJM(false)}><XI/></button></div>
            <div className="mbody">
              <div className="sec-div">Job Info</div>
              <div className="form-row three">
                <div><label className="fl">Job #</label><input className="fi" value={jobForm.jobnum||''} onChange={e=>setJF({...jobForm,jobnum:e.target.value})} placeholder="2024-0001"/></div>
                <div><label className="fl">Start Date</label><input type="date" className="fi" value={jobForm.startdate||''} onChange={e=>setJF({...jobForm,startdate:e.target.value})}/></div>
                <div><label className="fl">Target Complete</label><input type="date" className="fi" value={jobForm.enddate||''} onChange={e=>setJF({...jobForm,enddate:e.target.value})}/></div>
              </div>
              <div className="form-row">
                <div><label className="fl">Status</label>
                  <select className="fs" value={jobForm.status||'new'} onChange={e=>setJF({...jobForm,status:e.target.value})}>
                    <option value="new">New / Lead</option><option value="assess">Active ‚Äî Assessment</option>
                    <option value="drying">Active ‚Äî Drying</option><option value="remed">Active ‚Äî Remediation</option>
                    <option value="recon">Active ‚Äî Reconstruction</option><option value="pending">Pending ‚Äî Insurance</option>
                    <option value="complete">Completed</option><option value="cancelled">Cancelled</option>
                  </select></div>
                <div><label className="fl">Priority</label>
                  <select className="fs" value={jobForm.priority||'normal'} onChange={e=>setJF({...jobForm,priority:e.target.value})}>
                    <option value="normal">Normal</option><option value="high">High</option><option value="low">Low</option>
                  </select></div>
              </div>
              <div className="form-row">
                <div><label className="fl">Job Type</label>
                  <select className="fs" value={jobForm.type||'water'} onChange={e=>setJF({...jobForm,type:e.target.value})}>
                    <option value="water">Water Mitigation</option><option value="mold">Mold Remediation</option>
                    <option value="both">Water + Mold</option><option value="other">Other</option>
                  </select></div>
                <div><label className="fl">Category</label>
                  <select className="fs" value={jobForm.category||''} onChange={e=>setJF({...jobForm,category:e.target.value})}>
                    <option value="">‚Äî Select ‚Äî</option><option value="cat1">Cat 1 ‚Äî Clean Water</option>
                    <option value="cat2">Cat 2 ‚Äî Grey Water</option><option value="cat3">Cat 3 ‚Äî Black Water</option>
                  </select></div>
              </div>
              <div className="sec-div">Property</div>
              <div className="form-row one"><div><label className="fl">Property Address</label><input className="fi" value={jobForm.address||''} onChange={e=>setJF({...jobForm,address:e.target.value})} placeholder="123 Main St, City, State 00000"/></div></div>
              <div className="sec-div">Client / Contact</div>
              <div className="form-row">
                <div><label className="fl">Client Name</label><input className="fi" value={jobForm.client||''} onChange={e=>setJF({...jobForm,client:e.target.value})}/></div>
                <div><label className="fl">Phone</label><input className="fi" value={jobForm.phone||''} onChange={e=>setJF({...jobForm,phone:e.target.value})} placeholder="(555) 000-0000"/></div>
              </div>
              <div className="form-row">
                <div><label className="fl">Email</label><input className="fi" value={jobForm.email||''} onChange={e=>setJF({...jobForm,email:e.target.value})}/></div>
                <div><label className="fl">Alt. Contact</label><input className="fi" value={jobForm.altcontact||''} onChange={e=>setJF({...jobForm,altcontact:e.target.value})}/></div>
              </div>
              <div className="sec-div">Insurance</div>
              <div className="form-row">
                <div><label className="fl">Insurance Company</label><input className="fi" value={jobForm.insco||''} onChange={e=>setJF({...jobForm,insco:e.target.value})}/></div>
                <div><label className="fl">Claim #</label><input className="fi" value={jobForm.claim||''} onChange={e=>setJF({...jobForm,claim:e.target.value})}/></div>
              </div>
              <div className="form-row">
                <div><label className="fl">Adjuster Name</label><input className="fi" value={jobForm.adjuster||''} onChange={e=>setJF({...jobForm,adjuster:e.target.value})}/></div>
                <div><label className="fl">Adjuster Phone</label><input className="fi" value={jobForm.adjphone||''} onChange={e=>setJF({...jobForm,adjphone:e.target.value})} placeholder="(555) 000-0000"/></div>
              </div>
              <div className="form-row">
                <div><label className="fl">Policy #</label><input className="fi" value={jobForm.policy||''} onChange={e=>setJF({...jobForm,policy:e.target.value})}/></div>
                <div><label className="fl">Deductible</label><input className="fi" value={jobForm.deductible||''} onChange={e=>setJF({...jobForm,deductible:e.target.value})} placeholder="$ amount"/></div>
              </div>
              <div className="sec-div">Loss Details</div>
              <div className="form-row one"><div><label className="fl">Loss Description</label><textarea className="ft" rows="3" value={jobForm.description||''} onChange={e=>setJF({...jobForm,description:e.target.value})} placeholder="Source, affected areas, extent of damage‚Ä¶"/></div></div>
              <div className="form-row one"><div><label className="fl">Initial Notes</label><textarea className="ft" rows="3" value={jobForm.notes||''} onChange={e=>setJF({...jobForm,notes:e.target.value})} placeholder="Field notes, initial scope‚Ä¶"/></div></div>
            </div>
            <div className="mfooter">
              <button className="btn btn-ghost" onClick={()=>setSJM(false)}>Cancel</button>
              <button className="btn btn-amber" onClick={saveJob} disabled={saving}>{saving?'Saving‚Ä¶':'Save Job'}</button>
            </div>
          </div>
        </div>
      )}

      {/* BRIEFING MODAL */}
      {showBriefing&&(()=>{
        const alertJobs=getAlerts(jobs);
        const now=new Date();
        const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
        const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
        const overdue=alertJobs.filter(j=>j.fuDate&&j.fuDate<today).length;
        return(
          <div className="overlay" onClick={e=>e.target===e.currentTarget&&setSB(false)}>
            <div className="modal wide">
              <div className="br-hdr">
                <div className="br-icon"><BellIc/></div>
                <div>
                  <div className="br-date">{days[now.getDay()]} ¬∑ {months[now.getMonth()]} {now.getDate()}, {now.getFullYear()}</div>
                  <div className="br-title">Daily Job Briefing</div>
                  <div className="br-sub">{alertJobs.length>0?`${alertJobs.length} job${alertJobs.length!==1?'s':''} need your attention`:'All jobs are up to date!'}</div>
                </div>
                <button className="mclose" style={{marginLeft:'auto'}} onClick={()=>setSB(false)}><XI/></button>
              </div>
              <div className="br-body">
                {alertJobs.length===0?(
                  <div style={{padding:'40px 24px',textAlign:'center',color:'#5f6878'}}>
                    <div style={{fontSize:32,marginBottom:10}}>‚úÖ</div>
                    <div style={{fontFamily:"'Barlow Condensed',sans-serif",fontSize:20,fontWeight:700,color:'#9ba3b0',letterSpacing:'.05em'}}>All Caught Up</div>
                  </div>
                ):alertJobs.map(j=>{
                  const s=STATUS_MAP[j.status]||STATUS_MAP.new;
                  const fu=FU_MAP[j.fuStatus];
                  const ed=briefEdits[j.id]||{};
                  const jFuDate=ed.fuDate!==undefined?ed.fuDate:(j.fuDate||'');
                  const isOv2=jFuDate&&jFuDate<today;const isTd2=jFuDate===today;
                  return(
                    <div key={j.id} className="br-row">
                      <div className="br-left">
                        <div className="br-addr">{j.address||'(No address)'}</div>
                        <div className="br-meta">
                          <span className="sbadge" style={{color:s.color,borderColor:s.color+'44',fontSize:9,padding:'1px 6px'}}><span className="sdot"/>{s.label}</span>
                          {fu&&<span className="fu-pill" style={{color:fu.color,borderColor:fu.color+'44',fontSize:8}}>{fu.icon} {fu.label}</span>}
                          {jFuDate&&<span className={`due-chip${isOv2?' ov':isTd2?' td':''}`}>{isOv2?`Overdue: ${fmtDate(jFuDate)}`:isTd2?'Due Today':`Due: ${fmtDate(jFuDate)}`}</span>}
                          {j.fuNote&&<span style={{fontSize:10,color:'#9ba3b0',fontStyle:'italic'}}>"{j.fuNote}"</span>}
                        </div>
                      </div>
                      <div className="br-actions">
                        <select className="fu-sel" value={ed.fuStatus!==undefined?ed.fuStatus:(j.fuStatus||'')}
                          onChange={e=>{const v=e.target.value==='clear'?'':e.target.value;setBE(prev=>({...prev,[j.id]:{...(prev[j.id]||{}),fuStatus:v}}));}}>
                          <option value="">‚Äî Set Status ‚Äî</option>
                          <option value="waiting">‚è± Waiting Response</option><option value="followup">üìÖ Follow-Up Scheduled</option>
                          <option value="insurance">üõ° Waiting on Insurance</option><option value="equipment">üîß Pulled Equipment</option>
                          <option value="upload">‚úÖ Ready to Upload</option><option value="clear">‚Äî Clear Status ‚Äî</option>
                        </select>
                        <input type="date" className="fu-date-sel" value={jFuDate}
                          onChange={e=>setBE(prev=>({...prev,[j.id]:{...(prev[j.id]||{}),fuDate:e.target.value}}))}/>
                      </div>
                    </div>
                  );
                })}
              </div>
              <div className="br-footer">
                <div className="br-sum"><span style={{color:'#f59e0b',fontWeight:700}}>{alertJobs.length}</span> jobs{overdue>0&&<> ¬∑ <span style={{color:'#ef4444'}}>{overdue} overdue</span></>}</div>
                <div style={{display:'flex',gap:8}}>
                  <button className="btn btn-ghost btn-sm" onClick={()=>setSB(false)}>Dismiss</button>
                  <button className="btn btn-amber btn-sm" onClick={saveBriefing}>‚úì Save &amp; Close</button>
                </div>
              </div>
            </div>
          </div>
        );
      })()}

      {/* IMPORT MODAL */}
      {showImport&&(
        <div className="overlay" onClick={e=>e.target===e.currentTarget&&cancelImport()}>
          <div className="modal" style={{maxWidth:540}}>
            <div className="mhdr"><span className="mtitle">Import Jobs</span><button className="mclose" onClick={cancelImport}><XI/></button></div>
            <div className="mbody">
              {importState==='idle'&&(
                <>
                  <div style={{marginBottom:14,fontSize:13,color:'#9ba3b0',lineHeight:1.7}}>
                    Select a <code style={{background:'#21252d',border:'1px solid #2e3340',borderRadius:4,padding:'1px 6px',fontFamily:"'IBM Plex Mono',monospace",fontSize:11,color:'#06b6d4'}}>restore-export-*.json</code> file exported from any version of this app.
                  </div>
                  <div className="import-zone" onClick={()=>importRef.current.click()}>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" style={{width:36,height:36,color:'#5f6878',marginBottom:10,display:'block',margin:'0 auto 10px'}}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    <div style={{fontFamily:"'Barlow Condensed',sans-serif",fontSize:18,fontWeight:700,color:'#9ba3b0',marginBottom:5}}>Click to Choose File</div>
                    <div style={{fontSize:12,color:'#5f6878'}}>Select your exported JSON file</div>
                  </div>
                  <input ref={importRef} type="file" accept=".json,application/json" style={{display:'none'}} onChange={handleImportFile}/>
                  {importMsg&&<div className="import-status error">{importMsg}</div>}
                </>
              )}
              {importState==='confirm'&&importData&&(
                <>
                  <div className="import-status info" style={{marginBottom:14}}>Found <strong>{importData.length} job{importData.length!==1?'s':''}</strong> ‚Äî review and confirm.</div>
                  <div className="import-job-list">
                    {importData.map((j,i)=>{const s=STATUS_MAP[j.status]||STATUS_MAP.new;return(
                      <div key={i} className="import-job-item">
                        <div style={{width:4,height:36,background:s.color,borderRadius:2,flexShrink:0}}/>
                        <div style={{flex:1,minWidth:0}}>
                          <div className="import-job-addr">{j.address||'(No address)'}</div>
                          <div className="import-job-meta">{j.client||''}{j.client&&j.jobnum?' ¬∑ ':''}{j.jobnum||''}</div>
                        </div>
                        <span className="sbadge" style={{color:s.color,borderColor:s.color+'44',fontSize:9,padding:'1px 6px'}}><span className="sdot"/>{s.label}</span>
                      </div>
                    );})}
                  </div>
                  <div style={{fontSize:11,color:'#5f6878',fontFamily:"'IBM Plex Mono',monospace"}}>‚ö† Duplicate jobs (matching IDs) will be skipped.</div>
                </>
              )}
              {importState==='importing'&&<div style={{display:'flex',flexDirection:'column',alignItems:'center',padding:'36px 20px',gap:16}}><div className="spinner" style={{width:32,height:32}}/><div style={{fontFamily:"'IBM Plex Mono',monospace",fontSize:12,color:'#9ba3b0'}}>Importing‚Ä¶</div></div>}
              {importState==='done'&&<div className="import-status success" style={{padding:24}}>{importMsg}</div>}
              {importState==='error'&&<><div className="import-status error" style={{marginBottom:14}}>{importMsg}</div><button className="btn btn-ghost" style={{width:'100%'}} onClick={()=>{setIS('idle');setIM('');}}>Try Again</button></>}
            </div>
            {(importState==='idle'||importState==='confirm')&&(
              <div className="mfooter">
                <button className="btn btn-ghost" onClick={cancelImport}>Cancel</button>
                {importState==='confirm'&&<button className="btn btn-amber" onClick={confirmImport}>‚úì Import {importData?.length} Job{importData?.length!==1?'s':''}</button>}
              </div>
            )}
          </div>
        </div>
      )}

      {/* LIGHTBOX */}
      {lightbox&&(
        <div className="lightbox" onClick={()=>setLB(null)}>
          <img src={lightbox} alt=""/>
          <button className="lb-close" onClick={()=>setLB(null)}><XI/></button>
        </div>
      )}

      {saving&&<div className="saving-bar"><div className="spinner"/>Saving‚Ä¶</div>}
      {toast&&<div className={`toast ${toast.type}`}><span>{toast.type==='success'?'‚úì':'‚úï'}</span>{toast.msg}</div>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
body{background:#111316;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:14px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:#111316}::-webkit-scrollbar-thumb{background:#3a4152;border-radius:3px}
.app{display:flex;height:100vh;overflow:hidden;background:#111316}
.sidebar{width:248px;min-width:248px;background:#1a1d22;border-right:1px solid #2e3340;display:flex;flex-direction:column;overflow:hidden}
.sb-head{padding:16px 18px 12px;border-bottom:1px solid #2e3340}
.logo{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:900;letter-spacing:.08em;color:#f59e0b;text-transform:uppercase;line-height:1}
.logo-sub{display:block;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:500;letter-spacing:.25em;color:#5f6878;margin-top:3px;text-transform:uppercase}
.user-chip{margin-top:10px;display:flex;align-items:center;gap:8px;background:#21252d;border:1px solid #2e3340;border-radius:7px;padding:6px 9px}
.u-avatar{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Barlow Condensed',sans-serif;font-size:11px;font-weight:800;flex-shrink:0}
.u-name{font-size:12px;font-weight:500;color:#9ba3b0;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.logout-btn{background:none;border:none;cursor:pointer;color:#5f6878;padding:2px;border-radius:3px;transition:all .15s;display:flex;align-items:center}.logout-btn:hover{color:#ef4444}
.nav-sec{padding:12px 10px 6px}
.nav-lbl{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.2em;color:#5f6878;text-transform:uppercase;padding:0 8px;margin-bottom:5px}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;color:#9ba3b0;transition:all .15s;position:relative}
.nav-item:hover{background:#21252d;color:#e8eaed}.nav-item.active{background:rgba(245,158,11,.12);color:#f59e0b}
.nav-item.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:60%;background:#f59e0b;border-radius:0 2px 2px 0}
.nav-ic{width:15px;height:15px;flex-shrink:0}
.nav-bdg{margin-left:auto;background:#21252d;border:1px solid #3a4152;font-family:'IBM Plex Mono',monospace;font-size:10px;padding:1px 5px;border-radius:10px;color:#5f6878}
.nav-item.active .nav-bdg{background:rgba(245,158,11,.2);border-color:#f59e0b;color:#f59e0b}
.alert-strip{margin:6px 10px;background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.22);border-radius:8px;padding:9px 12px;cursor:pointer;transition:all .15s}.alert-strip:hover{background:rgba(245,158,11,.14)}
.alert-lbl{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:#f59e0b;margin-bottom:2px;display:flex;align-items:center;gap:5px}
.alert-num{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:800;color:#e8eaed;line-height:1}
.alert-sub{font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878;margin-top:1px}
.sb-stats{margin-top:auto;padding:12px;border-top:1px solid #2e3340;display:grid;grid-template-columns:1fr 1fr;gap:7px}
.stat-box{background:#21252d;border:1px solid #2e3340;border-radius:6px;padding:8px 10px}
.stat-v{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:#e8eaed;line-height:1}
.stat-l{font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878;letter-spacing:.1em;margin-top:2px}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.topbar{display:flex;align-items:center;gap:9px;padding:12px 18px;border-bottom:1px solid #2e3340;background:#1a1d22;flex-shrink:0}
.tb-title{font-family:'Barlow Condensed',sans-serif;font-size:19px;font-weight:700;letter-spacing:.04em;text-transform:uppercase;color:#e8eaed}
.search-box{display:flex;align-items:center;gap:7px;background:#21252d;border:1px solid #2e3340;border-radius:6px;padding:7px 11px;flex:1;max-width:340px;margin-left:auto}
.search-box svg{width:13px;height:13px;color:#5f6878;flex-shrink:0}
.search-box input{background:none;border:none;outline:none;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:13px;width:100%}
.search-box input::placeholder{color:#5f6878}
.btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:6px;font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;cursor:pointer;transition:all .15s;border:none;outline:none}
.btn svg{width:13px;height:13px}
.btn-amber{background:#f59e0b;color:#000}.btn-amber:hover{background:#fbbf24}
.btn-ghost{background:transparent;color:#9ba3b0;border:1px solid #2e3340}.btn-ghost:hover{background:#21252d;color:#e8eaed}
.btn-red{background:#ef4444;color:#fff}.btn-red:hover{background:#dc2626}
.btn-sm{padding:5px 10px;font-size:11px}
.bell-btn{position:relative;background:#21252d;border:1px solid #2e3340;border-radius:6px;color:#9ba3b0;width:34px;height:34px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0}.bell-btn:hover{background:#282d37;color:#e8eaed}
.bell-btn.ringing{color:#f59e0b;border-color:rgba(245,158,11,.4);animation:shake 4s ease infinite}
@keyframes shake{0%,90%,100%{transform:rotate(0)}92%{transform:rotate(-8deg)}94%{transform:rotate(8deg)}96%{transform:rotate(-5deg)}98%{transform:rotate(3deg)}}
.bell-btn svg{width:15px;height:15px}
.bell-count{position:absolute;top:-5px;right:-5px;background:#ef4444;color:white;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:700;min-width:15px;height:15px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 3px;border:2px solid #1a1d22}
.filterbar{display:flex;align-items:center;gap:5px;padding:9px 18px;border-bottom:1px solid #2e3340;overflow-x:auto;flex-shrink:0}
.fc{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-family:'IBM Plex Mono',monospace;font-size:10px;cursor:pointer;border:1px solid #2e3340;color:#9ba3b0;background:transparent;transition:all .15s;white-space:nowrap}
.fc:hover{border-color:#3a4152;color:#e8eaed}.fc.active{border-color:#f59e0b;color:#f59e0b;background:rgba(245,158,11,.1)}
.fc-dot{width:5px;height:5px;border-radius:50%}
.content{flex:1;overflow-y:auto;padding:16px 18px}
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:11px}
.job-card{background:#1a1d22;border:1px solid #2e3340;border-radius:10px;padding:14px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.job-card:hover{border-color:#3a4152;background:#21252d;transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.35)}
.card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px}
.jnum{font-family:'IBM Plex Mono',monospace;font-size:10px;color:#5f6878;letter-spacing:.1em}
.sbadge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:10px;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:500;border:1px solid;letter-spacing:.06em}
.sdot{width:4px;height:4px;border-radius:50%;background:currentColor}
.jaddr{font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700;letter-spacing:.02em;color:#e8eaed;margin-bottom:2px;line-height:1.2}
.jclient{font-size:11px;color:#9ba3b0;margin-bottom:9px}
.card-meta{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.ttag{display:inline-flex;align-items:center;padding:2px 6px;background:#21252d;border-radius:4px;font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:.1em;text-transform:uppercase}
.fu-pill{display:inline-flex;align-items:center;gap:4px;padding:2px 6px;border-radius:8px;font-family:'IBM Plex Mono',monospace;font-size:8px;font-weight:500;border:1px solid}
.meta-ic{display:flex;align-items:center;gap:3px;font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878}
.overdue-flag{position:absolute;top:9px;right:9px;background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);color:#ef4444;font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:.1em;padding:2px 5px;border-radius:3px}
.today-flag{position:absolute;top:9px;right:9px;background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.3);color:#f59e0b;font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:.1em;padding:2px 5px;border-radius:3px}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:70px 20px;text-align:center;color:#5f6878;gap:10px;grid-column:1/-1}
.empty svg{width:44px;height:44px;opacity:.25}.empty h3{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;letter-spacing:.05em;color:#9ba3b0}.empty p{font-size:12px;max-width:260px;line-height:1.7}
.spinner{width:28px;height:28px;border:3px solid #2e3340;border-top-color:#f59e0b;border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.back-btn{background:none;border:1px solid #2e3340;border-radius:6px;color:#9ba3b0;cursor:pointer;display:inline-flex;align-items:center;gap:6px;padding:5px 11px;font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;transition:all .15s;margin-bottom:12px}.back-btn:hover{background:#21252d;color:#e8eaed}.back-btn svg{width:13px;height:13px}
.detail-hdr{background:#1a1d22;border:1px solid #2e3340;border-radius:10px;padding:16px 20px;margin-bottom:12px;display:flex;align-items:flex-start;gap:12px}
.d-info{flex:1}.d-jnum{font-family:'IBM Plex Mono',monospace;font-size:10px;color:#5f6878;letter-spacing:.15em;margin-bottom:3px}
.d-addr{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:800;letter-spacing:.03em;color:#e8eaed;line-height:1.1;margin-bottom:7px}
.d-meta{display:flex;align-items:center;gap:9px;flex-wrap:wrap}.d-actions{display:flex;align-items:center;gap:7px;flex-shrink:0}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:11px;margin-bottom:12px}
.dcard{background:#1a1d22;border:1px solid #2e3340;border-radius:10px;padding:14px 16px}.dcard.full{grid-column:1/-1}
.dcard-title{font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:#5f6878;margin-bottom:11px;display:flex;align-items:center;gap:7px;justify-content:space-between}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px}
.iflbl{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:#5f6878;margin-bottom:3px}
.ifval{font-size:12px;color:#e8eaed;font-weight:500}.ifval.mono{font-family:'IBM Plex Mono',monospace;font-size:11px}.ifval.empty{color:#5f6878;font-style:italic;font-weight:400}
.notes-area{width:100%;background:#21252d;border:1px solid #2e3340;border-radius:6px;padding:9px 11px;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:13px;line-height:1.7;resize:vertical;min-height:90px;outline:none;transition:border-color .15s}.notes-area:focus{border-color:#f59e0b}
.notes-disp{font-size:12px;color:#9ba3b0;line-height:1.7;white-space:pre-wrap;min-height:40px}
.tl{position:relative;padding-left:20px}.tl::before{content:'';position:absolute;left:4px;top:8px;bottom:0;width:1px;background:#2e3340}
.tl-item{position:relative;margin-bottom:14px}
.tl-item::before{content:'';position:absolute;left:-16px;top:5px;width:8px;height:8px;border-radius:50%;background:#f59e0b;border:2px solid #111316}
.tl-date{font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878;letter-spacing:.08em;margin-bottom:2px;display:flex;align-items:center;gap:6px}
.tl-by{background:#21252d;border-radius:3px;padding:1px 5px;font-size:8px;color:#9ba3b0}
.tl-text{font-size:12px;color:#9ba3b0;line-height:1.5}
.tl-del{position:absolute;right:0;top:0;width:18px;height:18px;background:none;border:none;cursor:pointer;color:#5f6878;display:none;align-items:center;justify-content:center;border-radius:3px}.tl-item:hover .tl-del{display:flex}.tl-del:hover{background:#282d37;color:#ef4444}.tl-del svg{width:11px;height:11px}
.tl-add{display:flex;gap:7px;margin-top:9px}
.tl-input{flex:1;background:#21252d;border:1px solid #2e3340;border-radius:6px;padding:6px 10px;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:12px;outline:none;transition:border-color .15s}.tl-input:focus{border-color:#f59e0b}
.ph-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:7px}
.ph-item{position:relative;aspect-ratio:1;border-radius:6px;overflow:hidden;background:#21252d;border:1px solid #2e3340;cursor:pointer}
.ph-item img{width:100%;height:100%;object-fit:cover;transition:transform .2s}.ph-item:hover img{transform:scale(1.05)}
.ph-del{position:absolute;top:3px;right:3px;background:rgba(0,0,0,.7);border:none;border-radius:3px;color:white;width:20px;height:20px;cursor:pointer;display:none;align-items:center;justify-content:center}.ph-item:hover .ph-del{display:flex}.ph-del:hover{background:#ef4444}.ph-del svg{width:10px;height:10px}
.ph-add{aspect-ratio:1;border-radius:6px;border:2px dashed #3a4152;background:transparent;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;color:#5f6878;transition:all .15s;font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:.08em}.ph-add:hover{border-color:#f59e0b;color:#f59e0b;background:rgba(245,158,11,.08)}.ph-add svg{width:16px;height:16px}
.fu-panel{background:linear-gradient(135deg,rgba(245,158,11,.08),rgba(245,158,11,.02));border:1px solid rgba(245,158,11,.2);border-radius:10px;padding:13px 16px;margin-bottom:11px}
.fu-title{font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:#f59e0b;margin-bottom:9px;display:flex;align-items:center;gap:6px}
.fu-opts{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:6px;margin-bottom:9px}
.fu-opt{display:flex;align-items:center;gap:7px;padding:7px 10px;border-radius:7px;border:1px solid #3a4152;background:#21252d;color:#9ba3b0;font-family:'IBM Plex Mono',monospace;font-size:9px;cursor:pointer;transition:all .15s;text-align:left}.fu-opt:hover{background:#282d37;color:#e8eaed}
.fu-row{display:flex;align-items:center;gap:9px;padding-top:9px;border-top:1px solid #2e3340}
.fu-lbl{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:#5f6878;white-space:nowrap}
.fu-date-in{background:#21252d;border:1px solid #2e3340;border-radius:5px;color:#e8eaed;font-family:'IBM Plex Mono',monospace;font-size:10px;padding:5px 8px;outline:none;transition:border-color .15s}.fu-date-in:focus{border-color:#f59e0b}
.fu-date-disp{font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878}
.fu-note-row{display:flex;align-items:center;gap:7px;margin-top:7px}
.fu-note-in{flex:1;background:#21252d;border:1px solid #2e3340;border-radius:5px;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:12px;padding:5px 10px;outline:none;transition:border-color .15s}.fu-note-in:focus{border-color:#f59e0b}.fu-note-in::placeholder{color:#5f6878}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(4px);z-index:100;display:flex;align-items:center;justify-content:center;padding:18px;animation:fadeIn .15s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:#1a1d22;border:1px solid #3a4152;border-radius:12px;width:100%;max-width:660px;max-height:90vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.65);animation:modalIn .18s ease}
.modal.wide{max-width:720px}
@keyframes modalIn{from{opacity:0;transform:scale(.96) translateY(6px)}to{opacity:1;transform:scale(1) translateY(0)}}
.mhdr{padding:16px 20px 13px;border-bottom:1px solid #2e3340;display:flex;align-items:center;justify-content:space-between}
.mtitle{font-family:'Barlow Condensed',sans-serif;font-size:19px;font-weight:800;letter-spacing:.06em;text-transform:uppercase}
.mclose{background:none;border:none;cursor:pointer;color:#5f6878;padding:4px;border-radius:4px;transition:all .15s;display:flex}.mclose:hover{background:#282d37;color:#e8eaed}.mclose svg{width:17px;height:17px}
.mbody{padding:16px 20px}.mfooter{padding:12px 20px;border-top:1px solid #2e3340;display:flex;gap:9px;justify-content:flex-end}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.form-row.one{grid-template-columns:1fr}.form-row.three{grid-template-columns:1fr 1fr 1fr}
.fl{display:block;font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:#5f6878;margin-bottom:5px}
.fi,.fs,.ft{width:100%;background:#21252d;border:1px solid #2e3340;border-radius:6px;padding:8px 10px;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:13px;outline:none;transition:border-color .15s}
.fi:focus,.fs:focus,.ft:focus{border-color:#f59e0b}.fs option{background:#21252d}.ft{resize:vertical;min-height:66px;line-height:1.6}
.sec-div{font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:#5f6878;margin:14px 0 8px;display:flex;align-items:center;gap:8px}.sec-div::after{content:'';flex:1;height:1px;background:#2e3340}
.br-hdr{background:linear-gradient(135deg,rgba(245,158,11,.14),rgba(245,158,11,.04));border-bottom:1px solid rgba(245,158,11,.25);padding:16px 20px;display:flex;align-items:center;gap:12px}
.br-icon{width:40px;height:40px;background:rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.3);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#f59e0b;flex-shrink:0}.br-icon svg{width:19px;height:19px}
.br-date{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.2em;color:#f59e0b;text-transform:uppercase;margin-bottom:2px}
.br-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:800;letter-spacing:.06em;text-transform:uppercase;color:#e8eaed;line-height:1}
.br-sub{font-size:11px;color:#5f6878;margin-top:2px}.br-body{max-height:50vh;overflow-y:auto}
.br-row{display:flex;align-items:flex-start;gap:11px;padding:11px 20px;border-bottom:1px solid #2e3340;transition:background .15s}.br-row:last-child{border-bottom:none}.br-row:hover{background:#21252d}
.br-left{flex:1;min-width:0}.br-addr{font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;color:#e8eaed;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.br-meta{display:flex;align-items:center;gap:6px;margin-top:3px;flex-wrap:wrap}
.br-actions{display:flex;flex-direction:column;gap:4px;align-items:flex-end;flex-shrink:0}
.fu-sel{background:#21252d;border:1px solid #2e3340;border-radius:5px;color:#e8eaed;font-family:'IBM Plex Mono',monospace;font-size:9px;padding:4px 8px;cursor:pointer;outline:none;min-width:185px}.fu-sel:focus{border-color:#f59e0b}.fu-sel option{background:#21252d}
.fu-date-sel{background:#21252d;border:1px solid #2e3340;border-radius:5px;color:#9ba3b0;font-family:'IBM Plex Mono',monospace;font-size:9px;padding:4px 7px;cursor:pointer;outline:none;width:130px}
.br-footer{padding:11px 20px;border-top:1px solid #2e3340;display:flex;align-items:center;justify-content:space-between;background:#1a1d22}
.br-sum{font-family:'IBM Plex Mono',monospace;font-size:10px;color:#5f6878}
.due-chip{display:inline-flex;align-items:center;padding:2px 6px;border-radius:6px;font-family:'IBM Plex Mono',monospace;font-size:8px;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.3);color:#3b82f6}
.due-chip.ov{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.3);color:#ef4444}
.due-chip.td{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.3);color:#f59e0b;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.55}}
.auth-wrap{min-height:100vh;background:#111316;display:flex;align-items:center;justify-content:center;padding:24px;background-image:radial-gradient(ellipse at 20% 50%,rgba(245,158,11,.04) 0%,transparent 60%),radial-gradient(ellipse at 80% 20%,rgba(59,130,246,.04) 0%,transparent 50%)}
.auth-inner{width:100%;max-width:400px}
.auth-logo{font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;letter-spacing:.1em;color:#f59e0b;text-transform:uppercase;text-align:center;line-height:1}
.auth-sub{font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:500;letter-spacing:.28em;color:#5f6878;text-align:center;margin-top:4px;text-transform:uppercase}
.auth-card{background:#1a1d22;border:1px solid #3a4152;border-radius:14px;padding:28px;margin-top:24px;box-shadow:0 24px 80px rgba(0,0,0,.55)}
.auth-tabs{display:flex;border-bottom:1px solid #2e3340;margin-bottom:20px}
.atab{flex:1;padding:9px 0;text-align:center;font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;color:#5f6878;border-bottom:2px solid transparent;transition:all .15s;margin-bottom:-1px}.atab.active{color:#f59e0b;border-bottom-color:#f59e0b}
.af{margin-bottom:14px}.al{display:block;font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.18em;text-transform:uppercase;color:#5f6878;margin-bottom:5px}
.ai{width:100%;background:#21252d;border:1px solid #2e3340;border-radius:7px;padding:10px 12px;color:#e8eaed;font-family:'Barlow',sans-serif;font-size:13px;outline:none;transition:border-color .15s}.ai:focus{border-color:#f59e0b}.ai::placeholder{color:#5f6878}
.auth-btn{width:100%;background:#f59e0b;color:#000;border:none;border-radius:7px;padding:11px;font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;cursor:pointer;transition:background .15s;margin-top:4px}.auth-btn:hover{background:#fbbf24}.auth-btn:disabled{background:#92600a;cursor:not-allowed;opacity:.7}
.auth-err{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:6px;padding:8px 12px;color:#ef4444;font-size:12px;margin-bottom:12px;line-height:1.5}
.auth-note{text-align:center;margin-top:14px;font-size:11px;color:#5f6878;line-height:1.6}.auth-note strong{color:#9ba3b0}
.saving-bar{position:fixed;top:12px;left:50%;transform:translateX(-50%);background:#21252d;border:1px solid #2e3340;border-radius:20px;padding:5px 13px;font-family:'IBM Plex Mono',monospace;font-size:10px;color:#9ba3b0;display:flex;align-items:center;gap:6px;z-index:200}
.saving-bar .spinner{width:9px;height:9px;border-width:2px}
.toast{position:fixed;bottom:20px;right:20px;padding:9px 15px;border-radius:8px;font-size:12px;font-weight:500;color:#e8eaed;box-shadow:0 8px 24px rgba(0,0,0,.45);z-index:300;display:flex;align-items:center;gap:8px;animation:toastIn .2s ease}
@keyframes toastIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.toast.success{background:#21252d;border:1px solid #22c55e}.toast.error{background:#21252d;border:1px solid #ef4444}
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:400;display:flex;align-items:center;justify-content:center}
.lightbox img{max-width:90vw;max-height:90vh;object-fit:contain;border-radius:6px}
.lb-close{position:absolute;top:18px;right:18px;background:rgba(255,255,255,.1);border:none;border-radius:6px;color:white;width:34px;height:34px;cursor:pointer;display:flex;align-items:center;justify-content:center}.lb-close svg{width:16px;height:16px}
.import-zone{border:2px dashed #3a4152;border-radius:10px;padding:36px 24px;text-align:center;cursor:pointer;transition:all .2s;margin:4px 0 16px}.import-zone:hover{border-color:#f59e0b;background:rgba(245,158,11,.04)}
.import-job-list{max-height:260px;overflow-y:auto;border:1px solid #2e3340;border-radius:8px;margin:12px 0}
.import-job-item{display:flex;align-items:center;gap:10px;padding:9px 14px;border-bottom:1px solid #2e3340}.import-job-item:last-child{border-bottom:none}
.import-job-addr{font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;color:#e8eaed;flex:1}
.import-job-meta{font-family:'IBM Plex Mono',monospace;font-size:9px;color:#5f6878}
.import-status{padding:14px 16px;border-radius:8px;font-size:13px;font-weight:500;line-height:1.6;text-align:center}
.import-status.success{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:#22c55e}
.import-status.error{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#ef4444}
.import-status.info{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);color:#3b82f6}
</style>
</body>
</html>
